# EC DIGIT CSIRC Add-on for Sysdiagnose Analysis Framework (SAF)

## Overview

EC DIGIT CSIRC Add-on for Sysdiagnose Analysis Framework (SAF) is a Splunk Technical Addon designed to facilitate the collection and processing of the artefacts generated by the [Sysdiganose Analysis Framework (SAF)](https://github.com/EC-DIGIT-CSIRC/sysdiagnose). This addon provides a set of configurations and scripts to streamline data ingestion and ensure proper handling within the Splunk environment.

Sysdiagnose Analysis Framework (SAF) produces the following type of artefacts:

- Parsed data from a case in JSON or JSONL format. Particularly, this Addon will look into JSONL files only.
- Logs in JSONL format with troubleshooting information from the parsing/analysing process.
- Case information related to a sysdiagnose archive file from the case management.

## Features

This Addon maps all inputs to the index `digit_sysdiagnose` and all events (from all inputs) will obtain the time from the `timestamp` field.

It maps the SAF artefacts to the following splunk fields:

| SAF artefact | SAF folder/file | host | source | sourcetype | input type
|---|---|---|---|---|---
| Parsed data | parsed_data | host_segment | filename | `digit:saf:parseddata:json` | Folder monitoring
| Logs | logs| host_segment | filename | `digit:saf:logs:json` | Folder monitoring
| Devices/Cases information | cases.json | case_id | path/to/cases.json | `digit:saf:cases:json` | Scripted

[It extracts](https://docs.splunk.com/Documentation/Splunk/9.4.2/Knowledge/Createandmaintainsearch-timefieldextractionsthroughconfigurationfiles) the `case_id` from the path for the source types: `digit:saf:parseddata:json` and `digit:saf:logs:json`. So that you can correlate the information with `digit:saf:cases:json` by using the `case_id` field. Be aware that, due to `digit:saf:cases:json` source type comes from a scripted input the `host` field will also contain the hostname of the computer (Forwarder) where the script executed.

The scripted input attempts to be smart so that it keeps track of the already processed `case_id` by keeping a cache. If you encounter problems while ingesting cases, you may want to (1) take a look to the dedicated log file `ec_digit_saf_ta_read_cases.log` and backups `ec_digit_saf_ta_read_cases.log.X` (where X = 1, ...) and, (2) (selectively) delete the cache (entries) that you will find in the `local` folder.

## Installation Instructions

1. Create a new index named `digit_sysdiagnose`.
2. Download the SAF Addon package.
3. Extract the contents to your Splunk app directory, typically located at `$SPLUNK_HOME/etc/apps/`.
4. Restart Splunk to load the new addon.

| Instance type | Supported | Required | Description
|---------------|-----------|----------|------------
| Search head   | No       | No      | It does not include any dashboard.
| Indexer       | Yes       | Optional       | Not required if you use heavy forwarders to collect data. Required if you use universal forwarders to collect data.
| Heavy forwarder     | Yes       | See comments       | This add-on supports heavy forwarder.
| Universal forwarder | Yes       | Conditional       | This add-on needs the host to have Python installed or disable the scripted input.

## Usage

The Addon comes with default configuration files. You will have to override the default configuration of [`inputs.conf`](default/inputs.conf) and [`ec_digit_saf_ta_settings.conf`](default/ec_digit_saf_ta_settings.conf).

- Copy those files to the `local` folder.
- Edit `inputs.conf` so that the __monitor stanzas__ point to the proper folder path with SAF cases and the __host\_segment__ field points to the correct segment according to the configured path.
- Edit `ec_digit_saf_ta_settings.conf` so that the path within the section `cases` points to the path where to find the `cases.json` file. By default, at the root of the SAF cases folder. __Note:__ You can also tune the `logging` configuration.

You are ready to roll!

## Support

Feel free to report issues, start new discussions, or create pull requests in Github.

## References

- [Sysdiagnose Analysis Framework (SAF)](https://github.com/EC-DIGIT-CSIRC/sysdiagnose)
- [Develop Splunk apps for Splunk Cloud Platform or Splunk Enterprise](https://dev.splunk.com/enterprise/docs/developapps/)
- [Splunk - Source types for add-ons](https://docs.splunk.com/Documentation/AddOns/released/Overview/Sourcetypes)

# Licence

This project is released under the European Public Licence
<https://commission.europa.eu/content/european-union-public-licence_en>
